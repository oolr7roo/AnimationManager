[README](../README.md)


# ğŸ§± Animator Layer ì™„ì „ ê°€ì´ë“œ

**Animator Layer**ëŠ” â€œì—¬ëŸ¬ ê°œì˜ ì• ë‹ˆë©”ì´ì…˜ í¬ì¦ˆë¥¼ ì¸µ(layer)ì²˜ëŸ¼ ìŒ“ì•„â€ ìµœì¢… í¬ì¦ˆë¥¼ ë§Œë“œëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.  
ê¸°ë³¸(í•˜ì²´) ìœ„ì— **ìƒì²´/í‘œì •/ë¬´ê¸°/ë°˜ë™** ê°™ì€ ë™ì‘ì„ â€œë¶€ë¶„ì ìœ¼ë¡œâ€ ì–¹ê±°ë‚˜, **ê°€ë²¼ìš´ í”ë“¤ë¦¼/í˜¸í¡**ì„ **ê°€ì‚°(Additive)** ìœ¼ë¡œ ë”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 1) ë™ì‘ ì›ë¦¬ (í•œëˆˆì—)
- **Base Layer (Layer 0)**: ê°€ì¥ ì•„ë˜ì¸µ. ë³´í†µ **ì´ë™/ëŸ°/ì í”„** ë“± í•µì‹¬ ëª¨ì…˜ê³¼ **ë£¨íŠ¸ëª¨ì…˜**ì„ ë‹´ë‹¹.
- **ì¶”ê°€ ë ˆì´ì–´ (1, 2, â€¦)**: ìœ„ì—ì„œ **ê°€ì¤‘ì¹˜(Weight)** ì™€ **ë°©ì‹(Override/Additive)** ë¡œ Base ê²°ê³¼ì— ë§ì…í˜.
- **Avatar Mask**: ê° ë ˆì´ì–´ê°€ **ì–´ë–¤ ë³¸(ë¼ˆ)** ì—ë§Œ ì˜í–¥ì„ ì¤„ì§€ ì„ íƒ(ì˜ˆ: ìƒì²´ë§Œ).
- **Layer Weight**: 0~1. ê°’ì´ í´ìˆ˜ë¡ í•´ë‹¹ ë ˆì´ì–´ ì˜í–¥ì´ ì»¤ì§.
- **Blending**:
  - **Override**: ë§ˆìŠ¤í¬ë¡œ ì§€ì •í•œ ë³¸ì„ **ëŒ€ì²´**(ë®ì–´ì“°ê¸°).
  - **Additive**: ì•„ë˜ ë ˆì´ì–´ì™€ì˜ **ì°¨(ë¸íƒ€)** ë¥¼ **ê°€ì‚°**(ì„ì–´ ë”í•¨).

> ìµœì¢… í¬ì¦ˆ = Base ê²°ê³¼ â†’ (Layer1 ì ìš©) â†’ (Layer2 ì ìš©) â€¦ ìˆœì°¨ í•©ì„±

---

## 2) ë ˆì´ì–´ ì†ì„± ì •ë¦¬
| í•­ëª© | ì˜ë¯¸ | ê¶Œì¥/ì£¼ì˜ |
|---|---|---|
| **Blending** | Override / Additive | ìƒì²´ ì „ìš© ë™ì‘ = Override, ë¯¸ì„¸ í”ë“¤ë¦¼Â·í˜¸í¡ = Additive |
| **Weight** | 0~1 ë ˆì´ì–´ ì˜í–¥ë„ | ëŸ°íƒ€ì„ì—ì„œ ì„œì„œíˆ ê°€ê°(í¬ë¡œìŠ¤í˜ì´ë“œ ëŠë‚Œ) |
| **Avatar Mask** | ì˜í–¥ ì¤„ ë³¸(Transforms) ì„ íƒ | ìƒì²´ ë ˆì´ì–´ëŠ” **Hips ì œì™¸**(ë£¨íŠ¸/í•˜ì²´ ì œì™¸) ê¶Œì¥ |
| **IK Pass** | ì´ ë ˆì´ì–´ì—ì„œ IK ê³„ì‚° í—ˆìš© | ì†/ë°œ IK ì¡°ì •ì´ í•„ìš”í•  ë•Œ ON |
| **Synced Layer** | ë‹¤ë¥¸ ë ˆì´ì–´ì™€ ìƒíƒœë¨¸ì‹  **ë™ê¸°í™”** | í‘œì •/ë¬´ê¸° ë ˆì´ì–´ë¥¼ Baseì™€ ê°™ì€ ìƒíƒœëª…ìœ¼ë¡œ ë§ì¶° ë™ê¸°í™”í•  ë•Œ ìœ ìš© |

---

## 3) Override vs Additive
| êµ¬ë¶„ | í¬ì¦ˆê°€ ì•„ë˜ ë ˆì´ì–´ì™€ ì–´ë–»ê²Œ í•©ì„±ë˜ë‚˜ | ëŒ€í‘œ ìš©ë„ | íŒ |
|---|---|---|---|
| **Override** | ë§ˆìŠ¤í¬ë¡œ ì„ íƒëœ ë³¸ì„ **ë®ì–´ì”€** | ìƒì²´(ì¡°ì¤€/ì‚¬ê²©/ë¦¬ë¡œë“œ), ì† ì œìŠ¤ì²˜, í‘œì • êµì²´ | ë§ˆìŠ¤í¬ ë²”ìœ„ **ê²¹ì¹¨ ìµœì†Œí™”** |
| **Additive** | ì•„ë˜ ë ˆì´ì–´ í¬ì¦ˆì— **ì°¨ì´(ë¸íƒ€)ë¥¼ ë”í•¨** | í˜¸í¡, ì¹´ë©”ë¼ ë°˜ë™, ë¯¸ì„¸ í”ë“¤ë¦¼, ê°ì • ë¯¸ë¬˜ ë³€í™” | **Additiveìš© í´ë¦½** í•„ìš”(ë ˆí¼ëŸ°ìŠ¤ í¬ì¦ˆ ì„¤ì •) |

> Additive í´ë¦½: FBX/Clip Importì˜ **Animation íƒ­ â†’ Additive Reference Pose**(Pose Frame/Custom) ì„¤ì •.

---

## 4) Avatar Mask í•µì‹¬
- **ìƒì²´ ë ˆì´ì–´**ë¥¼ ë§Œë“¤ ë•ŒëŠ” `Hips/Root`ì™€ í•˜ì²´ë¥¼ **ì²´í¬ í•´ì œ** â†’ í•˜ì²´ëŠ” Baseê°€ ìœ ì§€, ìƒì²´ë§Œ ë³€ê²½.
- í‘œì •/ì†ê°€ë½ë§Œ ì œì–´í•  ë ˆì´ì–´ëŠ” í•´ë‹¹ ë³¸ë§Œ ì²´í¬.
- í•˜ë‚˜ì˜ ë³¸ì„ **ì—¬ëŸ¬ Override ë ˆì´ì–´**ê°€ ì¤‘ë³µìœ¼ë¡œ ê±´ë“œë¦¬ë©´ íŠ/ê¹œë¹¡ì„ ìœ„í—˜.

---

## 5) ë£¨íŠ¸ëª¨ì…˜Â·íŒŒë¼ë¯¸í„°Â·ì „í™˜
- **ë£¨íŠ¸ëª¨ì…˜**ì€ ë³´í†µ **Base Layer**ì—ì„œë§Œ ì‚¬ìš©(ìƒì¸µì€ Root/hips ì œì™¸ ë§ˆìŠ¤í¬ ê¶Œì¥).
- **íŒŒë¼ë¯¸í„°**(Bool/Float/Trigger)ëŠ” **ë ˆì´ì–´ ê°„ ê³µìœ **. ê° ë ˆì´ì–´ì˜ ì „í™˜ì€ **ì„œë¡œ ë…ë¦½**.
- ê°™ì€ ìˆœê°„ ì„œë¡œ ë‹¤ë¥¸ ë ˆì´ì–´ì—ì„œ ì „í™˜ì´ ì¼ì–´ë‚˜ë„ ë¨. ìµœì¢… í¬ì¦ˆëŠ” ë ˆì´ì–´ ìŠ¤íƒ ê²°ê³¼.

---

## 6) ì‹¤ì „ ì›Œí¬í”Œë¡œìš°

### 6-1) â€œë‹¬ë¦¬ë©´ì„œ ìƒì²´ë§Œ ë¦¬ë¡œë“œâ€
1. **Base Layer**: Locomotion(Idle/Walk/Run) Blend Tree.
2. **UpperBody Layer (Layer 1)**  
   - Blending = **Override**  
   - Avatar Mask = **ìƒì²´ ë³¸ë§Œ ì²´í¬**  
   - Weight = 0(ê¸°ë³¸), ë¦¬ë¡œë“œ ë•Œ 1ë¡œ ì˜¬ë¦¼  
   - ìƒíƒœ: `Reload`(Loop Off, Exit Timeìœ¼ë¡œ ëë‚˜ë©´ 0ìœ¼ë¡œ ë³µê·€)
3. **ë£¨íŠ¸ëª¨ì…˜**ì€ Baseì—ì„œë§Œ.

**ì½”ë“œ ì˜ˆì‹œ**
```csharp
// ë ˆì´ì–´ ì¸ë±ìŠ¤ ì–»ê¸°
int upper = animator.GetLayerIndex("UpperBody");

// ë¦¬ë¡œë“œ ì‹œì‘: ìƒì²´ ë ˆì´ì–´ ê°€ì¤‘ì¹˜ ì˜¬ë¦¬ë©´ì„œ ìƒíƒœ ì§„ì…
void StartReload()
{
    animator.CrossFadeInFixedTime("UpperBody.Reload", 0.08f, upper);
    StartCoroutine(FadeLayerWeight(upper, 1f, 0.12f));
}

// ì¢…ë£Œ ì‹œ ê°€ì¤‘ì¹˜ ì œê±°
void EndReload()
{
    StartCoroutine(FadeLayerWeight(upper, 0f, 0.15f));
}

System.Collections.IEnumerator FadeLayerWeight(int layer, float target, float dur)
{
    float t = 0f;
    float from = animator.GetLayerWeight(layer);
    while (t < dur)
    {
        t += Time.deltaTime;
        float w = Mathf.Lerp(from, target, t / dur);
        animator.SetLayerWeight(layer, w);
        yield return null;
    }
    animator.SetLayerWeight(layer, target);
}
```